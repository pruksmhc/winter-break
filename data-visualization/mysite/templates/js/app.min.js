(function(){
	function a(t){
		if(t.region!==n)
			return;
		e.textContent=t.region;
		var r=u.nodes(h(t)).filter(function(e){
			return!e.children});
		var i=o.selectAll("circle").data(r,function(e){
			return e.name});
		var a=500;
		var f=0;i.transition().duration(a).delay(function(e,t){f=t*7;return f}).attr("transform",function(e){return"translate("+e.x+","+e.y+")"}).attr("r",function(e){return e.r}).style("opacity",1);i.enter().append("circle").attr("transform",function(e){return"translate("+e.x+","+e.y+")"}).attr("r",function(e){return 0}).attr("class",function(e){return e.className}).transition().duration(a*1.2).attr("transform",function(e){return"translate("+e.x+","+e.y+")"}).attr("r",function(e){return e.r}).style("opacity",1);i.exit().transition().duration(a).attr("transform",function(e){var t=e.y-s/2;var n=e.x-s/2;var r=Math.atan2(t,n);var i=s*(1+Math.cos(r))/2;var o=s*(1+Math.sin(r))/2;return"translate("+i+","+o+")"}).attr("r",function(e){return 0}).remove()}function c(){var e=0;l.subscribe({channel:f,callback:function(e){a(e)}})}function h(e){if(!e)return;var t=e.countries_msg_vol;var n=[];for(var r in t){n.push({name:r,className:r.toLowerCase().replace(/ /g,""),size:t[r]})}return{children:n}}var e=document.getElementById("region");var t=document.getElementById("dataCenterPicker");var n=t.options[t.selectedIndex].value;t.addEventListener("change",function(e){n=t.options[t.selectedIndex].value;console.log(n)},false);var r=true;var i=document.getElementById("toggle");i.addEventListener("click",function(e){if(r){l.unsubscribe({channel:f});i.value="Stream again";r=false}else{c();i.value="Stop me!";r=true}},false);var s=Math.min(document.getElementById("chart").clientWidth,window.innerHeight-document.querySelector("header").clientHeight)-20;var o=d3.select("#chart").append("svg").attr("width",s).attr("height",s);var u=d3.layout.pack().size([s,s]).value(function(e){return e.size}).padding(3);var f="rts-xNjiKP4Bg4jgElhhn9v9";var l=PUBNUB.init({subscribe_key:"e19f2bb0-623a-11df-98a1-fbd39d75aa3f"});c()})()
